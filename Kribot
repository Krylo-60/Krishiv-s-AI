<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KriBot â€“ ChatGPT Clone</title>
<link rel="icon" href="https://img.icons8.com/color/48/000000/artificial-intelligence.png" type="image/png">
<style>
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background-color: #ffffff;
  color: #000000;
}
.dark { background-color: #202123; color: #f7f7f8; }
.container {
  width: 600px;
  max-width: 95%;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  border: 1px solid #ddd;
  background-color: #ffffff;
}
.dark .container { background-color: #2b2b2b; border-color: #444; }
.header {
  background-color: #10a37f;
  color: white;
  font-weight: bold;
  font-size: 18px;
  padding: 12px 16px;
}
.controls {
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  padding: 6px 12px;
}
.controls button {
  font-size: 12px;
  padding: 5px 8px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background: #f0f0f0;
}
.controls button:hover { background: #ccc; }
.chat {
  flex: 1;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  overflow-y: auto;
  scroll-behavior: smooth;
  background-color: #f7f7f8;
}
.dark .chat { background-color: #202123; }
.message {
  display: flex;
  max-width: 80%;
  padding: 12px 16px;
  border-radius: 20px;
  word-wrap: break-word;
  opacity: 0;
  animation: fadeIn 0.3s forwards;
}
.message.user {
  align-self: flex-end;
  background: #0a84ff;
  color: white;
  border-bottom-right-radius: 2px;
  border-bottom-left-radius: 20px;
}
.message.ai {
  align-self: flex-start;
  background: #f3f3f3;
  color: #202123;
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 20px;
}
.dark .message.ai { background: #3a3a3c; color: #f7f7f8; }
.message.ai img {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  margin-right: 10px;
  flex-shrink: 0;
  background-color: #10a37f;
  padding: 4px;
}
.typing {
  display: flex;
  align-items: center;
  gap: 6px;
  padding-left: 6px;
}
.dot {
  width: 6px; height: 6px;
  background: gray; border-radius: 50%;
  opacity: 0.3;
  animation: blink 1s infinite;
}
.dot:nth-child(1){ animation-delay: 0s; }
.dot:nth-child(2){ animation-delay: 0.2s; }
.dot:nth-child(3){ animation-delay: 0.4s; }
@keyframes blink {0%,80%,100%{opacity:0.3;}40%{opacity:1;}}
.input-area {
  display: flex;
  padding: 12px;
  gap: 6px;
  border-top: 1px solid #ccc;
  background-color: #f7f7f8;
}
.dark .input-area { background-color: #202123; border-top-color: #444; }
input {
  flex: 1;
  padding: 10px 16px;
  border-radius: 25px;
  border: 1px solid #ccc;
  font-size: 14px;
}
.dark input { border-color: #555; background-color:#333; color:white; }
.send {
  border:none; background:#10a37f; color:white;
  border-radius:50%; width:40px; height:40px; cursor:pointer; font-size:16px;
}
.send:hover { background:#0d7c64; }
.footer { text-align:center; padding:8px; font-size:12px; color:gray; }
@keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
</style>
</head>

<body>
<div class="container">
  <div class="header">ðŸ¤– KriBot â€“ ChatGPT Style</div>
  <div class="controls">
    <button onclick="clearChat()">ðŸ—‘ Clear</button>
    <button onclick="toggleDark()">ðŸŒ™ Dark</button>
    <button onclick="resetAPI()">ðŸ”‘ Reset Key</button>
  </div>
  <div class="chat" id="chat">
    <div class="message ai">
      <img src="https://img.icons8.com/color/48/000000/robot-2.png">
      <span>AI: Hello! Iâ€™m <b>KriBot</b>, your AI assistant. Type a question or use the ðŸŽ¤ button.</span>
    </div>
    <div class="message ai">
      <img src="https://img.icons8.com/color/48/000000/robot-2.png">
      <span>Created by Krishiv, Grade 6 Student.</span>
    </div>
  </div>
  <div class="typing" id="typing"></div>
  <div class="input-area">
    <input id="question" placeholder="Type a message...">
    <button class="send" onclick="startVoice()">ðŸŽ¤</button>
    <button class="send" onclick="askAI()">âž¤</button>
  </div>
  <div class="footer">Created by Krishiv, Grade 6 Student</div>
</div>

<script>
const chat=document.getElementById("chat");
const typing=document.getElementById("typing");

/* Restore chat + theme */
chat.innerHTML += localStorage.getItem("chat")||"";
if(localStorage.getItem("dark")==="yes") document.body.classList.add("dark");

/* API key prompt */
function askForAPIKey() {
  let key = localStorage.getItem("OPENAI_API_KEY");
  while(!key || key.trim()===""){
    key = prompt("Enter your OpenAI API key to use KriBot:");
    if(key && key.trim()!=="") localStorage.setItem("OPENAI_API_KEY", key.trim());
  }
  return key;
}
let OPENAI_API_KEY = askForAPIKey();

/* Save chat */
function saveChat(){ localStorage.setItem("chat",chat.innerHTML); }

/* Add message */
function addMessage(text,cls){
  const div=document.createElement("div");
  div.className="message "+cls;
  if(cls==="ai"){
    const img=document.createElement("img");
    img.src="https://img.icons8.com/color/48/000000/robot-2.png";
    div.appendChild(img);
  }
  const span=document.createElement("span");
  span.innerHTML=text;
  div.appendChild(span);
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  saveChat();
}

/* Typing dots */
function showTyping(){ typing.innerHTML='<span class="dot"></span><span class="dot"></span><span class="dot"></span>'; }
function hideTyping(){ typing.innerHTML=''; }

/* Clear chat */
function clearChat(){ if(confirm("Clear chat?")){ chat.innerHTML=''; hideTyping(); localStorage.removeItem("chat"); } }

/* Dark mode */
function toggleDark(){ document.body.classList.toggle("dark"); localStorage.setItem("dark",document.body.classList.contains("dark")?"yes":"no"); }

/* Reset API */
function resetAPI(){ localStorage.removeItem("OPENAI_API_KEY"); OPENAI_API_KEY = askForAPIKey(); alert("API key updated!"); }

/* Voice input */
function startVoice(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR) return alert("Voice not supported");
  const r=new SR(); r.lang="en-IN"; r.onresult=e=>document.getElementById("question").value=e.results[0][0].transcript; r.start();
}

/* Get AI answer from OpenAI */
async function getAnswerOnline(question){
  const url="https://api.openai.com/v1/chat/completions";
  const res=await fetch(url,{
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":`Bearer ${OPENAI_API_KEY}`},
    body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:question}],temperature:0.7})
  });
  const data = await res.json();
  return data.choices[0].message.content;
}

/* Ask AI with typing animation */
async function askAI(){
  const q=document.getElementById("question").value.trim();
  if(!q) return;

  addMessage(q,"user");
  document.getElementById("question").value="";
  showTyping();

  try{
    const answer = await getAnswerOnline(q);
    hideTyping();

    // AI bubble
    const div = document.createElement("div");
    div.className = "message ai";
    const img = document.createElement("img");
    img.src = "https://img.icons8.com/color/48/000000/robot-2.png";
    div.appendChild(img);
    const span = document.createElement("span");
    div.appendChild(span);
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;

    // Animate typing character by character
    let i = 0;
    function typeChar() {
      if(i < answer.length){
        span.innerHTML += answer.charAt(i);
        i++;
        chat.scrollTop = chat.scrollHeight;
        setTimeout(typeChar,15);
      } else saveChat();
    }
    typeChar();

  } catch(err){
    hideTyping();
    addMessage("Error: Could not get answer. Check API key / internet.","ai");
    console.error(err);
  }
}

// Send message on Enter key
document.getElementById("question").addEventListener("keydown", function(e){
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault();
    askAI();
  }
});
</script>
</body>
</html>
